<%= content_for :title, "Geschäft bearbeiten" %>

<section class="content-container">
  <div class="flex gap-2 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <p class="text-sm uppercase tracking-[0.35em] text-primary/80">Angaben zu Ihrem Geschäft</p>
      <h1 class="text-3xl font-bold text-base-content sm:text-4xl">
        <%= @business.business_name.presence || "Geschäft einrichten" %>
      </h1>
    </div>
  </div>

  <% if @business.errors.any? %>
    <div class="mt-6 alert alert-error flex-col items-start gap-2">
      <div class="font-semibold">Bitte korrigieren Sie die folgenden Angaben:</div>
      <ul class="list-disc pl-5 text-sm">
        <% @business.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with model: @business, url: app_mystore_path, local: true, html: { class: "mt-8", multipart: true } do |form| %>
    <h3 class="text-2xl">Geschäftsinformationen</h3>
    <p class="mb-5">Die Angaben in dieser Sektion werden auf der Website des ersten Advents
      für alle Besucher:innen öffentlich gelistet.</p>
    <div class="grid gap-6 md:grid-cols-2">
      <div class="form-control">
        <div class="flex flex-row gap-2 items-baseline">
          <%= form.label :business_name, "Geschäftsname", class: "label-text font-semibold" %>

        </div>

        <%= form.text_field :business_name,
                        class: "input input-bordered w-full",
                        placeholder: "Mein Geschäft" %>

      </div>
      <div class="form-control md:col-span-2">
        <%= render "shared/multiselect",
        form: form,
        field_name: :categories,
        label: "Kategorien",
        subtext: "Wählen Sie alle Kategorien, die zu Ihrem Geschäft passen.",
        options: @categories,
        selected_options: @selected_categories %>
      </div>
      <div class="form-control md:col-span-2">
        <%= form.label :address, "Gasse und Hausnummer", class: "label-text font-semibold" %>
        <%= form.text_area :address,
                       rows: 3,
                       class: "textarea textarea-bordered w-full",
                       placeholder: "Strasse 1\n8000 Zürich" %>
      </div>

      <div class="form-control">
        <%= form.label :phone, "Telefonnummer (Geschäft)", class: "label-text font-semibold" %>
        <%= form.telephone_field :phone,
                             class: "input input-bordered w-full",
                             placeholder: "+41 44 123 45 67" %>
      </div>
      <div class="form-control">
        <%= form.label :email,
                   "E-Mail-Adresse (Geschäft)",
                   class: "label-text font-semibold" %>
        <%= form.email_field :email,
                         class: "input input-bordered w-full",
                         placeholder: "kontakt@mein-geschäft.ch" %>
      </div>

      <div class="form-control col-span-2">
        <%= form.label :website, "Webseite", class: "label-text font-semibold" %>
        <%= form.url_field :website,
                       class: "input input-bordered w-full",
                       placeholder: "https://mein-geschäft.ch" %>
      </div>

      <div class="md:col-span-2 space-y-4">
        <h4 class="text-lg font-semibold">Social Media (optional)</h4>
        <div class="grid gap-6 md:grid-cols-2">
          <div class="form-control">
            <%= form.label :instagram, "Instagram", class: "label-text font-semibold" %>
            <%= form.url_field :instagram,
                           class: "input input-bordered w-full",
                           placeholder: "https://instagram.com/ihrprofil" %>
          </div>

          <div class="form-control">
            <%= form.label :tiktok, "TikTok", class: "label-text font-semibold" %>
            <%= form.url_field :tiktok,
                           class: "input input-bordered w-full",
                           placeholder: "https://www.tiktok.com/@ihrprofil" %>
          </div>

          <div class="form-control">
            <%= form.label :linkedin, "LinkedIn", class: "label-text font-semibold" %>
            <%= form.url_field :linkedin,
                           class: "input input-bordered w-full",
                           placeholder: "https://www.linkedin.com/company/ihrprofil" %>
          </div>

          <div class="form-control">
            <%= form.label :facebook, "Facebook", class: "label-text font-semibold" %>
            <%= form.url_field :facebook,
                           class: "input input-bordered w-full",
                           placeholder: "https://www.facebook.com/ihrprofil" %>
          </div>
        </div>
      </div>

      <div class="form-control md:col-span-2">
        <%= form.label :map_link, "Google-Maps-Link", class: "label-text font-semibold" %>
        <%= form.url_field :map_link,
                       class: "input input-bordered w-full",
                       placeholder: "https://maps.google.com/..." %>
      </div>

    </div>

    <section class="w-full my-10 gap-6">
      <h3 class="text-xl">Hauptbild</h3>
      <p class="text-sm text-base-content/70 mb-5">Wird auf der Übersichtsseite angezeigt</p>

      <%= render "shared/image_with_actions",
      image_url: @business.main_image,
      delete_path: purge_image_app_mystore_path(image: :main_image),
      form: form,
      image_field: :main_image %>

      <h3 class="text-xl mt-5">Galeriebilder</h3>
      <p class="text-sm text-base-content/70 mb-5">Diese Bilder werden (Zusätzlich zum Hautpbild) auf der Detailseite
        angezeigt. Laden Sie bis zu 3 Bilder hoch, um Ihr Geschäft besser zu
        präsentieren.</p>
      <div class="flex-row flex flex-wrap gap-3 mb-3">

        <%= render "shared/image_with_actions",
        image_url: @business.image_gallery1,
        delete_path: purge_image_app_mystore_path(image: :image_gallery1),
        form: form,
        image_field: :image_gallery1 %>

        <%= render "shared/image_with_actions",
        image_url: @business.image_gallery2,
        delete_path: purge_image_app_mystore_path(image: :image_gallery2),
        form: form,
        image_field: :image_gallery2 %>

        <%= render "shared/image_with_actions",
        image_url: @business.image_gallery3,
        delete_path: purge_image_app_mystore_path(image: :image_gallery3),
        form: form,
        image_field: :image_gallery3 %>
      </div>

    </section>

    <section class="space-y-6">
      <div class="form-control">
        <%= form.label :first_advent_specialities,
                   "Besonderes am 1. Advent (optional)",
                   class: "label-text font-semibold" %>
        <%= form.rich_textarea :first_advent_specialities %>
      </div>

      <div class="form-control">
        <%= form.label :description,
                   "Text für die Website",
                   class: "label-text font-semibold" %>
        <%= form.rich_textarea :description %>
      </div>

    </section>

    <hr class="mt-5"/>
    <h3 class="text-2xl mt-5">Kontaktinfos</h3>
    <p class="mb-5">Diese angaben sind nicht öffentlich, sondern dienen zur Administration
      des Anlasses</p>

    <div class="grid gap-6 md:grid-cols-2">

      <div class="form-control">
        <%= form.label :contact_name, "Vor- und Nachname", class: "label-text font-semibold" %>
        <%= form.text_field :contact_name,
                        class: "input input-bordered w-full",
                        placeholder: "" %>
      </div>

      <div class="form-control">
        <%= form.label :billing_address,
                   "Rechnungsadresse",
                   class: "label-text font-semibold" %>
        <%= form.text_area :billing_address,
                       rows: 3,
                       class: "textarea textarea-bordered w-full",
                       placeholder: "Strasse 1\n8000 Zürich" %>
      </div>
    </div>

    <div class="flex flex-wrap justify-end gap-3 mt-10">
      <%= link_to "Abbrechen", app_mystore_path, class: "btn btn-outline" %>
      <%= form.submit(
        @business.persisted? ? "Änderungen speichern" : "Geschäft anlegen",
        class: "btn btn-primary",
      ) %>
    </div>
  <% end %>

</section>
